#!/usr/bin/env node

const fs = require('fs');
const mysql_handler = require('./mysql-handler');

const args = process.argv;
var config = JSON.parse(fs.readFileSync('.config'));

function help() {
    let output =
        "Final Project for the course Databases II\n\n"
        + "Commands:\n\n"
        + "db create        create the database with the configured name\n"
        + "db migrate       migrate the database structure\n"
        + "db ping          check database connection\n\n"
        + "help             shows available commands\n";
    console.log(output);
}

const commands = {
    'db': () => {
        const sub = {
            'create': () => {
                mysql_handler.createDatabase(config.mysql.host, config.mysql.user, config.mysql.password, config.mysql.database);
            },
            'migrate': () => {
                mysql_handler.migrateDatabase(config.mysql.host, config.mysql.user, config.mysql.password, config.mysql.database);
            },
            'ping': () => {
                mysql_handler.pingDatabase(config.mysql.host, config.mysql.user, config.mysql.password);
            }
        };
        try {
            sub[args[3]]();
        }
        catch (err) {
            console.log('Invalid command.');
        }
    },
    'help': help
}

try {
    commands[args[2]]();
}
catch (err) {
    console.log('Invalid command.');
}